<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="SwiftWasm Blog"/><link rel="canonical" href="https://blog.swiftwasm.org/posts/update-04-november-2020"/><meta name="twitter:url" content="https://blog.swiftwasm.org/posts/update-04-november-2020"/><meta name="og:url" content="https://blog.swiftwasm.org/posts/update-04-november-2020"/><title>What's new in SwiftWasm #4 | SwiftWasm Blog</title><meta name="twitter:title" content="What's new in SwiftWasm #4 | SwiftWasm Blog"/><meta name="og:title" content="What's new in SwiftWasm #4 | SwiftWasm Blog"/><meta name="description" content="An update on what happened in the SwiftWasm ecosystem during November 2020."/><meta name="twitter:description" content="An update on what happened in the SwiftWasm ecosystem during November 2020."/><meta name="og:description" content="An update on what happened in the SwiftWasm ecosystem during November 2020."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/splash.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://fonts.googleapis.com/css2?family=Lora:wght@600&display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to SwiftWasm Blog"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">SwiftWasm Blog</a></div></header><div class="wrapper"><article><p><small>Published on <time datetime="2020-11-30T14:34:00Z">November 30, 2020.</time></small></p><div class="content"><h1>What's new in SwiftWasm #4</h1><h2>SwiftWasm 5.3.0 and 5.3.1 releases</h2><p>As you may have seen in <a href="https://blog.swiftwasm.org/posts/5-3-released/">our previous post</a>, we've published <a href="https://github.com/swiftwasm/swift/releases/tag/swift-wasm-5.3.0-RELEASE">our first stable release</a> recently. Shortly after that, <a href="https://github.com/flavio">@flavio</a> reported <a href="https://github.com/swiftwasm/swift/issues/2223">an issue with <code>JSONDecoder</code></a>. Following <a href="https://github.com/swiftwasm/swift/pull/2240">an investigation</a> by <a href="https://github.com/kateinoigakukun">@kateinoigakukun</a> into the root cause of the issue, we've published <a href="https://github.com/swiftwasm/swift/releases/tag/swift-wasm-5.3.1-RELEASE">SwiftWasm 5.3.1</a>, which also included updates from the upstream 5.3.1 patch release.</p><p>(If you're interested in technical details, the <code>JSONDecoder</code> issue was caused by a peculiar assumption about memory layout in Swift runtime, which wasn't applicable to WebAssembly's linear memory. <a href="https://github.com/swiftwasm/swift/pull/2240/files">Check the PR diff</a> for more details.)</p><h2>Libraries</h2><h3>JavaScriptKit</h3><p>A major update since the latest 0.8.0 release of JavaScriptKit is <a href="https://github.com/swiftwasm/JavaScriptKit/pull/102">newly added support for throwing functions</a> developed by <a href="https://github.com/kateinoigakukun">@kateinoigakukun</a>. It required an update to the JavaScript runtime part, but was an additive change to the Swift API. As we try to publish releases regularly, <a href="https://github.com/swiftwasm/JavaScriptKit/releases/tag/0.9.0">new 0.9.0 release</a> was tagged that includes this feature.</p><p><a href="https://github.com/swiftwasm/JavaScriptKit/pull/107">A PR with support for Asyncify transformation</a> was created by <a href="https://github.com/yonihemi">@yonihemi</a>. It allows calling asynchronous JavaScript APIs with Swift code that looks as plain synchronous code, but through proper suspension that doesn't block browser rendering. The PR has some implications on how we build things, especially as it requires a specific optimizer transformation. It is still in the draft stage, and you're welcome to contribute to the ongoing discussion.</p><h3>OpenCombine</h3><p>We still use <a href="https://github.com/TokamakUI/OpenCombine">a fork of OpenCombine</a> in Tokamak due to our custom implementation of the <code>ObservableObject</code> protocol. In addition to that, our fork also contained some changes to the package manifest to make it build with SwiftWasm, but they made it incompatible with non-Wasm platforms. This issue was <a href="https://github.com/OpenCombine/OpenCombine/pull/191">resolved in the upstream OpenCombine repository</a>, which reduced the amount of customizations we apply, and brings us closer to using the upstream repository as is.</p><h3>OpenCombineJS</h3><p>With progress on OpenCombine, it was time to publish the first version of <a href="https://github.com/swiftwasm/OpenCombineJS">OpenCombineJS</a>. Its code didn't change recently, but parts of it were used in Tokamak already, which gave us confidence that it was reliable enough to be released in a separate library for wider use. It currently doesn't contain much code, but this basic functionality should be enough for basic integration of JavaScriptKit types and OpenCombine.</p><h3>Tokamak</h3><p>Following <a href="https://github.com/TokamakUI/Tokamak/releases/tag/0.5.0">the 0.5.0 release</a>, which added support for the latest <code>carton</code>, we published <a href="https://github.com/TokamakUI/Tokamak/releases/tag/0.5.1">a small 0.5.1 patch</a> with support for editing Tokamak projects in Xcode with working autocomplete. Not long after that <a href="https://github.com/TokamakUI/Tokamak/pull/301">an important bugfix</a> landed in <a href="https://github.com/TokamakUI/Tokamak/releases/tag/0.5.2">0.5.2</a>, which fixed an issue with display order of updated views in the DOM renderer. A few weeks later another <a href="https://github.com/TokamakUI/Tokamak/releases/tag/0.5.3">bugfix release</a> was published as 0.5.3. In this update Tokamak now internally relies on the aforementioned OpenCombineJS library instead of providing its own <code>JSScheduler</code> type conforming to Combine's <code>Scheduler</code>. More importantly, it fixes <a href="https://github.com/TokamakUI/Tokamak/issues/287">a bug with <code>Toggle</code> not being updated</a> after resetting it from a binding.</p><h2>Developer tools</h2><h3>WasmTransformer</h3><p><a href="https://github.com/kateinoigakukun">@kateinoigakukun</a> <a href="https://github.com/swiftwasm/WasmTransformer/commit/d79d945731e03a10cb2806cbafc0be0113a2b9bf">implemented</a> a <code>stripCustomSections</code> transformation in <a href="https://github.com/swiftwasm/WasmTransformer">the <code>WasmTransformer</code> library</a>. <a href="https://webassembly.github.io/spec/core/appendix/custom.html">According to the spec</a>, data in custom sections should not contribute to observed behavior of a given binary. In the case of binaries produced by SwiftWasm, custom sections contain debugging information that can now be stripped with</p><p><code>WasmTransformer</code>.</p><h3><code>carton</code></h3><p>Previously, custom sections were stripped to reduce final binary size as a build step in `carton bundle<code> with the </code>wasm-strip` utility from <a href="https://github.com/webassembly/wabt">WABT</a>. Thanks to the new transformation in <code>WasmTransformer</code>, WABT is no longer needed as a dependency of <code>carton</code>, which makes installation for our end users simpler and faster.</p><p>Initial support for presenting crash stack traces directly in <code>carton</code> has been completed, starting with <a href="https://github.com/swiftwasm/carton/pull/162">Firefox support</a>. Support for more browsers will be added in separate PRs.</p><p>There was also work on <a href="https://github.com/swiftwasm/carton/pull/171">file downloader cleanup</a>, <a href="https://github.com/swiftwasm/carton/pull/173">support for browser testing</a>, and <a href="https://github.com/swiftwasm/carton/pull/176">simpler URLs for main bundle resources</a>. As soon as these are merged, a new version of <code>carton</code> will be tagged that will use the latest 5.3.1 release of SwiftWasm.</p><h2>Contributions</h2><p>A lot of the progress wouldn't be possible without payments from our GitHub Sponsors. Their contribution is deeply appreciated and allows us to spend more time on SwiftWasm projects. You can see the list of sponsors and make your contribution on the sponsorship pages of <a href="https://github.com/sponsors/carson-katri">Carson Katri</a>, <a href="https://github.com/sponsors/kateinoigakukun">Yuta Saito</a> and <a href="https://github.com/sponsors/MaxDesiatov">Max Desiatov</a>.</p><p>Thanks for reading! ðŸ‘‹</p></div></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>